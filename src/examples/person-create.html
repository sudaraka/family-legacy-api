<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Family Legacy API - Create Person Example</title>
</head>
<body>
    <h1>Create New Person (user)</h1>

    <!-- Input form - start -->
    <fieldset>
        <legend>User Information</legend>

        <label for="first_name_input">First Name</label>
        <input type="text" id="first_name_input">
        <br>

        <label for="last_name_input">Last Name</label>
        <input type="text" id="last_name_input">
        <br>

        <label for="email_input">Email Address</label>
        <input type="text" id="email_input">
        <br>

        <label for="password_input">Password</label>
        <input type="password" id="password_input">
        <br>

        <label for="avatar_url_input">Avatar URL</label>
        <input type="text" id="avatar_url_input">
        <br>

        <hr>
        <button type="button" id="btn_create">Create Person</button>
    </fieldset>
    <!-- Input form - end -->

    <textarea id="result" cols="80" rows="24" readonly></textarea>

<script src="https://code.jquery.com/jquery-2.1.3.min.js"></script>

<script>

var API_BASE = 'http://api.ourfamilylegacy.org/';  // Base URL for the API resources

// Place holder to store URL of newly create person for future reference
var new_person_url;

// Capture button click event of the form, gather form input content and submit
// AJAX request to API

$('#btn_create').on('click', function() {  // Button click event

    // Create a JavaScript Object from values in the input boxes
    var person_data = {
        first_name: $('#first_name_input').val(),
        last_name: $('#last_name_input').val(),
        email: $('#email_input').val(),
        password: $('#password_input').val(),
        avatar: $('#avatar_url_input').val()
    };

    $.ajax({
        url: API_BASE + 'persons/',  // http://api.ourfamilylegacy.org/persons/
        method: 'POST',  // Do a HTTP POST to create
        contentType: 'application/json',  // Submit object in JSON format
        data: JSON.stringify(person_data)  // Serialize the object we created in to JSON string
    })
    .done(function(result) {
        // API call returned successfully (HTTP 200)
        // At this point API will return the URL for newly created resource
        // (Person object) in the "Location" HTTP header

        // Store new Person URL for future reference
        new_person_url = xhr.getResponseHeader('Location');

        console.log('New resource (Person) URL', new_person_url);

        $('#result').text(xhr.getAllResponseHeaders());
    })
    .fail(function(xhr) {
        // API call returned a failed status

        if(xhr.responseJSON) {
            // Errors handled or generated by API system is returned as a JSON
            //object

            // Summary message
            console.warn('Error:', xhr.responseJSON.error);

            // Details of the error
            console.log('Message:', xhr.responseJSON.message);

            $('#result').text(JSON.stringify(xhr.responseJSON));
        }
        else {
            // Errors handled or generated *out side* the API system is
            // returned as a standard HTTP (HTML or plain text) response

            $('#result').text(JSON.stringify(xhr.responseText));
        }
    })

});

</script>

</body>
</html>
